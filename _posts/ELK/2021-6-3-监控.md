---
title: 监控
category: ELK
typora-root-url: ../../
---

 

## ES节点监控

Metricbeat

> https://www.elastic.co/guide/en/beats/metricbeat/7.12/metricbeat-installation-configuration.html

0. 启动ES集群监视数据收集，kibana执行

   ```
   GET /_cluster/settings?pretty
   PUT /_cluster/settings?pretty
   {
   
     "persistent": {
   
       "xpack.monitoring.collection.enabled": true
   
     }
   
   }
   ```

   

1. 下载

   ```
   curl -L -O https://artifacts.elastic.co/downloads/beats/metricbeat/metricbeat-7.12.1-linux-x86_64.tar.gz
   tar xzvf metricbeat-7.12.1-linux-x86_64.tar.gz
   ```

   

2. 连接到ES，编辑 metricbeat.yml

   ```
   output.elasticsearch:
     # Array of hosts to connect to.
     hosts: ["http://10.138.0.150:9200", "http://10.138.0.151:9200", "http://10.138.0.152:9200"] 
   
     # Optional protocol and basic auth credentials.
     #protocol: "https"
     username: "remote_monitoring_user"
     password: "metricbeat"
     
   setup.kibana:
       host: "10.138.0.160:5601" 
       username: "metricbeat"  
       password: "metricbeat"
   ```

   

3. 启动ES模块，进入安装目录

   ```
   ./metricbeat modules enable elasticsearch-xpack
   ```

4. 修改 modules.d/elasticsearch-xpack.yml

   ```
   - module: elasticsearch
       xpack.enabled: true
       period: 10s
       hosts: ["http://localhost:9200"] 
       #scope: node 
       username: "remote_monitoring_user"
       password: "metricbeat"
   ```

5. 禁用系统模块

   ```
   ./metricbeat modules disable system
   ```

6. 启动

   ```
   sudo su
   chown root metricbeat.yml 
   chown root modules.d/*
   echo "nohup ./metricbeat &" > start.sh
   ```

   
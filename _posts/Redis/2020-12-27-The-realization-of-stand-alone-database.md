---
title: 第二部分-单机数据库的实现
category: Redis
typora-root-url: ../../
---

 

## 服务器中数据库

默认创建16个数据库

用

SELECT 0 - 15 

选择数据库

不同数据库键和值相对独立

## 设置键的生存时间或过期时间

```
> setex k1 30 "lihenan"
OK
> ttl k1
(integer) 26
> ttl k1
(integer) 25
> get k1
"lihenan"
```

```
> expire key2 20
(integer) 1
> ttl key2
(integer) 15
> pttl key2
10945
```

通过expire 秒为单位 和 pexpire 毫秒为单位

expireat 和 pexpireat 设置过期时间戳

persist 移除过期时间

ttl 和 pttl 返回键的剩余生存时间，返回-2表示key不存在

## 过期键删除策略

## Redis过期键的删除策略

对于过期键一般有三种删除策略

- 定时删除：在设置键的过期时间的同时，创建一个定时器(timer)，让定时器在键的过期时间来临时，立即执行对键的删除操作；
- 惰性删除：放任键过期不管，但是每次从键空间中获取键时，都检查取得的键是否过期，如果过期的话，就删除该键；如果没有过期，那就返回该键；
- 定期删除：每隔一段时间，程序就对数据库进行一次检查，删除里面的过期键。至于删除多少过期键，以及要检查多少个数据库，则由算法决定。

下面我们来看看三种策略的优缺比较：

定时删除占用太多CPU时间，影响服务器的响应时间和吞吐量；

惰性删除浪费太多内存，有内存泄漏的危险。



定期删除策略是前两种策略的一种整合和折中：

- 定期删除策略每隔一段时间执行一次删除过期键操作，并通过**限制删除操作执行的时长和频率**来减少删除操作对CPU时间的影响；
- 通过定期删除过期键，定期删除策略有效地减少了因为过期键而带来的内存浪费；
- 定期删除策略的难点是确定删除操作执行的时长和频率。

Redis的过期键删除策略：Redis服务器实际使用的是 **惰性删除** 和 **定期删除** 两种策略。